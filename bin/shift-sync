#!/usr/bin/env bash
projects_dir=$HOME/Projects/openshift
host=$1

skip_build=false

if [ -z "$host" ]; then host="verifier"; fi
if [ "$2" == "--tests" ]; then skip_build=true; fi

function update_git {
  dir=$1
  echo "Fixing up staging area for ${dir}"
  pushd "${projects_dir}/${dir}" 1>/dev/null
  git add -u . && git add .
  popd 1>/dev/null
}

function start_sync {
  pushd "${projects_dir}/li" 1>/dev/null
  
  if $skip_build ; then
    echo "Syncing only tests to ${host}"
    build/devenv sync $host --skip-build
  else
    echo "Syncing everything to ${host}"
    build/devenv sync $host
  fi

  popd 1>/dev/null
}

update_git li
update_git crankcase

start_sync

update_git li
update_git crankcase
